# ESP32 MicroPython ä»£ç ä¸Šä¼ å®Œæ•´æŒ‡å—

## ğŸ“‹ ç›®å½•
- [å‰ç½®å‡†å¤‡](#å‰ç½®å‡†å¤‡)
- [å›ºä»¶çƒ§å½•](#å›ºä»¶çƒ§å½•)
- [ä»£ç ä¸Šä¼ æ–¹æ³•](#ä»£ç ä¸Šä¼ æ–¹æ³•)
- [æ–‡ä»¶ç®¡ç†](#æ–‡ä»¶ç®¡ç†)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

## ğŸ”§ å‰ç½®å‡†å¤‡

### 1. å®‰è£…å¿…è¦å·¥å…·
```bash
# å®‰è£… Python 3 (å¦‚æœæœªå®‰è£…)
# macOS: brew install python3
# Ubuntu: sudo apt install python3 python3-pip

# å®‰è£… esptool (ç”¨äºå›ºä»¶çƒ§å½•)
pip3 install esptool

# å®‰è£…ä»£ç ä¸Šä¼ å·¥å…· (é€‰æ‹©å…¶ä¸€)
pip3 install adafruit-ampy    # ampy å·¥å…·
pip3 install mpremote         # mpremote å·¥å…·
```

### 2. è¯†åˆ«è®¾å¤‡ç«¯å£
```bash
# macOS
ls /dev/tty.usbserial-* /dev/tty.SLAB_USBtoUART /dev/tty.usbmodem*

# Linux
ls /dev/ttyUSB* /dev/ttyACM*

# Windows (åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­)
mode
```

### 3. ç¡®è®¤èŠ¯ç‰‡å‹å·
```bash
python3 -m esptool chip_id
```

## ğŸ”¥ å›ºä»¶çƒ§å½•

### ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ (æ¨è)
```bash
# ESP32 ç»å…¸æ¬¾
./flash_esp32.sh [ç«¯å£å·]

# ESP32-S3
./flash_esp32s3.sh [ç«¯å£å·]
```

### æ‰‹åŠ¨çƒ§å½•å‘½ä»¤

#### ESP32 ç»å…¸æ¬¾
```bash
# 1. æ“¦é™¤é—ªå­˜
python3 -m esptool --chip esp32 --port /dev/tty.usbserial-xxxx erase_flash

# 2. çƒ§å½•å›ºä»¶
python3 -m esptool --chip esp32 --port /dev/tty.usbserial-xxxx write_flash -z 0x1000 esp32/esp32-micropython.bin
```

#### ESP32-S3
```bash
# 1. æ“¦é™¤é—ªå­˜
python3 -m esptool --chip esp32s3 --port /dev/tty.usbserial-xxxx erase_flash

# 2. çƒ§å½•å›ºä»¶ (æ³¨æ„åœ°å€æ˜¯ 0x0)
python3 -m esptool --chip esp32s3 --port /dev/tty.usbserial-xxxx write_flash -z 0x0 esp32s3/esp32s3-micropython.bin
```

#### ESP32-C3
```bash
# 1. æ“¦é™¤é—ªå­˜
python3 -m esptool --chip esp32c3 --port /dev/tty.usbserial-xxxx erase_flash

# 2. çƒ§å½•å›ºä»¶
python3 -m esptool --chip esp32c3 --port /dev/tty.usbserial-xxxx write_flash -z 0x0 esp32c3/esp32c3-micropython.bin
```

## ğŸ’» ä»£ç ä¸Šä¼ æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šThonny IDE (æœ€é€‚åˆåˆå­¦è€…)

1. **å®‰è£… Thonny**
   - ä¸‹è½½ï¼šhttps://thonny.org/
   - æ”¯æŒ Windowsã€macOSã€Linux

2. **é…ç½®è¿æ¥**
   - å·¥å…· â†’ é€‰é¡¹ â†’ è§£é‡Šå™¨
   - é€‰æ‹© "MicroPython (ESP32)"
   - è®¾ç½®æ­£ç¡®çš„ç«¯å£å’Œæ³¢ç‰¹ç‡ (115200)

3. **ä¸Šä¼ ä»£ç **
   - åœ¨ç¼–è¾‘å™¨ä¸­ç¼–å†™ä»£ç 
   - ç‚¹å‡» "è¿è¡Œ" æŒ‰é’®ç›´æ¥æ‰§è¡Œ
   - æ–‡ä»¶ â†’ å¦å­˜ä¸º â†’ é€‰æ‹© "MicroPython è®¾å¤‡" ä¿å­˜åˆ°è®¾å¤‡

4. **æ–‡ä»¶ç®¡ç†**
   - æŸ¥çœ‹ â†’ æ–‡ä»¶ â†’ æ˜¾ç¤ºæ–‡ä»¶é¢æ¿
   - å¯ä»¥ç›´æ¥æ‹–æ‹½æ–‡ä»¶åˆ°è®¾å¤‡

### æ–¹æ³•äºŒï¼šampy å·¥å…· (å‘½ä»¤è¡Œ)

```bash
# è®¾ç½®ç«¯å£å˜é‡ (æ–¹ä¾¿ä½¿ç”¨)
export AMPY_PORT=/dev/tty.usbserial-xxxx

# ä¸Šä¼ å•ä¸ªæ–‡ä»¶
ampy put main.py

# ä¸Šä¼ å¹¶é‡å‘½å
ampy put local_file.py remote_file.py

# ä¸Šä¼ æ•´ä¸ªç›®å½•
ampy put src/ /

# åˆ—å‡ºè®¾å¤‡æ–‡ä»¶
ampy ls

# æŸ¥çœ‹æ–‡ä»¶å†…å®¹
ampy get main.py

# åˆ é™¤æ–‡ä»¶
ampy rm main.py

# åˆ›å»ºç›®å½•
ampy mkdir lib

# è¿è¡Œæ–‡ä»¶
ampy run test.py
```

### æ–¹æ³•ä¸‰ï¼šmpremote å·¥å…· (å®˜æ–¹æ¨è)

```bash
# è¿æ¥è®¾å¤‡
mpremote connect /dev/tty.usbserial-xxxx

# ä¸Šä¼ æ–‡ä»¶
mpremote connect /dev/tty.usbserial-xxxx cp main.py :

# ä¸Šä¼ åˆ°æŒ‡å®šç›®å½•
mpremote connect /dev/tty.usbserial-xxxx cp main.py :/lib/

# ä¸‹è½½æ–‡ä»¶
mpremote connect /dev/tty.usbserial-xxxx cp :main.py .

# åˆ—å‡ºæ–‡ä»¶
mpremote connect /dev/tty.usbserial-xxxx ls

# æ‰§è¡Œæ–‡ä»¶
mpremote connect /dev/tty.usbserial-xxxx exec "exec(open('main.py').read())"

# è¿›å…¥ REPL
mpremote connect /dev/tty.usbserial-xxxx repl
```

### æ–¹æ³•å››ï¼šä¸²å£ç»ˆç«¯ (ç›´æ¥è¾“å…¥)

```bash
# è¿æ¥åˆ°è®¾å¤‡
screen /dev/tty.usbserial-xxxx 115200

# æˆ–ä½¿ç”¨ minicom (Linux)
minicom -D /dev/tty.usbserial-xxxx -b 115200

# åœ¨ REPL ä¸­ç›´æ¥è¾“å…¥ä»£ç 
>>> print("Hello ESP32!")
>>> import machine
>>> led = machine.Pin(2, machine.Pin.OUT)
>>> led.on()
```

### æ–¹æ³•äº”ï¼šVS Code + Pymakr æ’ä»¶

1. **å®‰è£…æ’ä»¶**
   - åœ¨ VS Code ä¸­æœç´¢å¹¶å®‰è£… "Pymakr" æ’ä»¶

2. **é…ç½®é¡¹ç›®**
   - åˆ›å»º `pymakr.conf` æ–‡ä»¶
   ```json
   {
       "address": "/dev/tty.usbserial-xxxx",
       "username": "micro",
       "password": "python",
       "sync_folder": "",
       "open_on_start": true
   }
   ```

3. **åŒæ­¥ä»£ç **
   - Ctrl+Shift+P â†’ "Pymakr: Upload project"

## ğŸ“ æ–‡ä»¶ç®¡ç†

### é‡è¦æ–‡ä»¶è¯´æ˜
- `boot.py` - è®¾å¤‡å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œç”¨äºåˆå§‹åŒ–è®¾ç½®
- `main.py` - boot.py æ‰§è¡Œåè‡ªåŠ¨è¿è¡Œï¼Œä¸»ç¨‹åºå…¥å£
- `lib/` - è‡ªå®šä¹‰æ¨¡å—ç›®å½•
- `config.py` - é…ç½®æ–‡ä»¶ (è‡ªå®šä¹‰)

### å…¸å‹é¡¹ç›®ç»“æ„
```
ESP32 è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿ/
â”œâ”€â”€ boot.py          # å¯åŠ¨é…ç½®
â”œâ”€â”€ main.py          # ä¸»ç¨‹åº
â”œâ”€â”€ config.py        # é…ç½®æ–‡ä»¶
â”œâ”€â”€ lib/             # åº“æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ sensor.py    # ä¼ æ„Ÿå™¨æ¨¡å—
â”‚   â””â”€â”€ wifi_manager.py  # WiFi ç®¡ç†æ¨¡å—
â””â”€â”€ data/            # æ•°æ®æ–‡ä»¶ç›®å½•
    â””â”€â”€ settings.json
```

### ç¤ºä¾‹ boot.py
```python
# boot.py -- åœ¨å¯åŠ¨æ—¶è¿è¡Œ
import esp
import gc
import webrepl

# ç¦ç”¨è°ƒè¯•ä¿¡æ¯
esp.osdebug(None)

# å¯åŠ¨åƒåœ¾å›æ”¶
gc.collect()

# å¯åŠ¨ WebREPL (å¯é€‰)
webrepl.start()

print("Boot completed")
```

### ç¤ºä¾‹ main.py
```python
# main.py -- ä¸»ç¨‹åº
import machine
import time

# åˆå§‹åŒ– LED
led = machine.Pin(2, machine.Pin.OUT)

# ä¸»å¾ªç¯
while True:
    led.on()
    time.sleep(0.5)
    led.off()
    time.sleep(0.5)
```

## â— å¸¸è§é—®é¢˜

### 1. ç«¯å£è¿æ¥é—®é¢˜
```bash
# é”™è¯¯ï¼šPermission denied
sudo chmod 666 /dev/tty.usbserial-xxxx

# æˆ–å°†ç”¨æˆ·æ·»åŠ åˆ° dialout ç»„ (Linux)
sudo usermod -a -G dialout $USER
# éœ€è¦é‡æ–°ç™»å½•ç”Ÿæ•ˆ
```

### 2. è®¾å¤‡æ— å“åº”
- æŒ‰ä½ BOOT æŒ‰é’®ï¼Œç„¶åæŒ‰ RST æŒ‰é’®è¿›å…¥ä¸‹è½½æ¨¡å¼
- æ£€æŸ¥ USB çº¿æ˜¯å¦æ”¯æŒæ•°æ®ä¼ è¾“
- å°è¯•ä¸åŒçš„ USB ç«¯å£

### 3. å›ºä»¶çƒ§å½•å¤±è´¥
```bash
# æ‰‹åŠ¨è¿›å…¥ä¸‹è½½æ¨¡å¼
# 1. æŒ‰ä½ BOOT æŒ‰é’®
# 2. æŒ‰ä¸€ä¸‹ RST æŒ‰é’®
# 3. æ¾å¼€ RST æŒ‰é’®
# 4. æ¾å¼€ BOOT æŒ‰é’®
# 5. é‡æ–°æ‰§è¡Œçƒ§å½•å‘½ä»¤
```

### 4. ä»£ç ä¸Šä¼ å¤±è´¥
- ç¡®è®¤è®¾å¤‡å·²æ­£ç¡®çƒ§å½• MicroPython å›ºä»¶
- æ£€æŸ¥ç«¯å£å·æ˜¯å¦æ­£ç¡®
- å°è¯•é‡å¯è®¾å¤‡
- æ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œæƒé™

### 5. å†…å­˜ä¸è¶³
```python
# åœ¨ä»£ç ä¸­æ·»åŠ åƒåœ¾å›æ”¶
import gc
gc.collect()

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
import micropython
micropython.mem_info()
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ä»£ç ç»„ç»‡
- å°†å¤æ‚åŠŸèƒ½æ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å—
- ä½¿ç”¨ `lib/` ç›®å½•å­˜æ”¾è‡ªå®šä¹‰æ¨¡å—
- ä¿æŒ `main.py` ç®€æ´ï¼Œä¸»è¦ç”¨äºè°ƒç”¨å…¶ä»–æ¨¡å—

### 2. é”™è¯¯å¤„ç†
```python
try:
    # å¯èƒ½å‡ºé”™çš„ä»£ç 
    import wifi_manager
    wifi_manager.connect()
except Exception as e:
    print(f"Error: {e}")
    # é”™è¯¯å¤„ç†é€»è¾‘
```

### 3. èµ„æºç®¡ç†
```python
# åŠæ—¶é‡Šæ”¾èµ„æº
import gc

def heavy_function():
    # æ‰§è¡Œå†…å­˜å¯†é›†æ“ä½œ
    result = process_data()
    gc.collect()  # æ‰‹åŠ¨åƒåœ¾å›æ”¶
    return result
```

### 4. è°ƒè¯•æŠ€å·§
```python
# ä½¿ç”¨ print è°ƒè¯•
print(f"Variable value: {variable}")

# ä½¿ç”¨å¼‚å¸¸æ•è·
try:
    risky_operation()
except Exception as e:
    print(f"Debug: {type(e).__name__}: {e}")
```

### 5. ç‰ˆæœ¬æ§åˆ¶
- åœ¨æœ¬åœ°ä½¿ç”¨ Git ç®¡ç†ä»£ç 
- å®šæœŸå¤‡ä»½è®¾å¤‡ä¸Šçš„é‡è¦æ–‡ä»¶
- ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–‡ä»¶åå’Œæ³¨é‡Š

### 6. æ€§èƒ½ä¼˜åŒ–
- é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¤§é‡å¯¹è±¡
- ä½¿ç”¨ç”Ÿæˆå™¨è€Œä¸æ˜¯åˆ—è¡¨ (èŠ‚çœå†…å­˜)
- åˆç†ä½¿ç”¨ `time.sleep()` é¿å… CPU å ç”¨è¿‡é«˜

## ğŸ”— ç›¸å…³èµ„æº

- [MicroPython å®˜æ–¹æ–‡æ¡£](https://docs.micropython.org/)
- [ESP32 MicroPython æ•™ç¨‹](https://docs.micropython.org/en/latest/esp32/tutorial/index.html)
- [Thonny IDE å®˜ç½‘](https://thonny.org/)
- [esptool æ–‡æ¡£](https://docs.espressif.com/projects/esptool/en/latest/)

---

*æœ€åæ›´æ–°ï¼š2025-09-14*
