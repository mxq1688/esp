# NRF24L01 无线通信控制器

基于ESP32-C3的NRF24L01无线通信控制器项目，支持发送、接收和双向通信模式。

## 功能特性

- **多种工作模式**: 支持发送模式、接收模式和双向模式
- **可配置参数**: 通道、数据速率、发射功率、数据包大小等
- **实时通信**: 基于FreeRTOS的多任务架构，支持实时数据收发
- **错误处理**: 完善的错误处理和状态监控
- **调试支持**: 详细的日志输出和状态信息

## 硬件连接

### NRF24L01 模块连接

| NRF24L01 引脚 | ESP32-C3 引脚 | 说明 |
|---------------|---------------|------|
| CE            | GPIO2         | 芯片使能 |
| CSN           | GPIO3         | 片选信号 |
| MISO          | GPIO4         | SPI数据输入 |
| MOSI          | GPIO5         | SPI数据输出 |
| SCK           | GPIO6         | SPI时钟 |
| VCC           | 3.3V          | 电源 |
| GND           | GND           | 地线 |

### 连接示意图

```
ESP32-C3                    NRF24L01
┌─────────┐                 ┌─────────┐
│ GPIO2   │ ─────────────── │ CE      │
│ GPIO3   │ ─────────────── │ CSN     │
│ GPIO4   │ ─────────────── │ MISO    │
│ GPIO5   │ ─────────────── │ MOSI    │
│ GPIO6   │ ─────────────── │ SCK     │
│ 3.3V    │ ─────────────── │ VCC     │
│ GND     │ ─────────────── │ GND     │
└─────────┘                 └─────────┘
```

## 软件架构

### 文件结构

```
nrf24l01_controller/
├── CMakeLists.txt              # 项目构建配置
├── sdkconfig.defaults          # 默认SDK配置
├── README.md                   # 项目说明
└── main/
    ├── CMakeLists.txt          # 主组件构建配置
    ├── main.c                  # 主程序
    ├── nrf24l01_driver.h       # NRF24L01驱动头文件
    ├── nrf24l01_driver.c       # NRF24L01驱动实现
    ├── nrf24l01_config.h       # 配置头文件
    └── nrf24l01_config.c       # 配置实现
```

### 核心组件

1. **NRF24L01驱动层**: 提供底层SPI通信和寄存器操作
2. **配置管理**: 硬件和应用参数配置
3. **应用层**: 多任务数据收发处理
4. **主程序**: 系统初始化和任务调度

## 编译和烧录

### 环境要求

- ESP-IDF v4.4 或更高版本
- ESP32-C3开发板
- NRF24L01无线模块

### 编译步骤

1. 激活ESP-IDF环境:
```bash
source /path/to/esp-idf/export.sh
```

2. 进入项目目录:
```bash
cd /path/to/nrf24l01_controller
```

3. 配置项目:
```bash
idf.py menuconfig
```

4. 编译项目:
```bash
idf.py build
```

5. 烧录到设备:
```bash
idf.py -p /dev/cu.usbmodem1101 flash monitor
```

### 使用构建脚本

项目提供了便捷的构建脚本 `build_nrf24l01.sh`:

```bash
./build_nrf24l01.sh
```

## 配置选项

### 工作模式

在 `sdkconfig.defaults` 中配置工作模式:

```bash
# 发送模式
CONFIG_NRF24L01_MODE_SENDER=y

# 接收模式  
CONFIG_NRF24L01_MODE_RECEIVER=y

# 双向模式 (默认)
CONFIG_NRF24L01_MODE_BOTH=y
```

### 通信参数

默认配置:
- **通道**: 76 (2.476GHz)
- **数据速率**: 1Mbps
- **发射功率**: 0dBm
- **数据包大小**: 32字节
- **地址**: 01:02:03:04:05

## 使用方法

### 发送模式

设备将定期发送数据包，包含序列号和时间戳信息。

### 接收模式

设备持续监听无线信号，接收并处理数据包。

### 双向模式

设备同时支持发送和接收功能，可以实现双向通信。

## 调试和监控

### 日志输出

程序提供详细的日志输出，包括:
- 初始化状态
- 数据收发记录
- 错误信息
- 系统状态

### 状态监控

通过串口监视器可以查看:
- NRF24L01寄存器状态
- 数据包统计
- 系统运行状态

## 故障排除

### 常见问题

1. **SPI通信失败**
   - 检查硬件连接
   - 确认引脚配置正确
   - 检查电源电压

2. **无法接收数据**
   - 确认通道设置一致
   - 检查地址配置
   - 验证天线连接

3. **数据包丢失**
   - 调整发射功率
   - 检查距离和障碍物
   - 降低数据速率

### 调试技巧

1. 使用 `idf.py monitor` 查看详细日志
2. 检查NRF24L01状态寄存器
3. 验证SPI通信是否正常
4. 测试不同通道和功率设置

## 扩展功能

### 自定义数据格式

可以修改 `data_packet_t` 结构体来支持自定义数据格式。

### 多通道支持

通过修改配置可以支持多通道通信。

### 网络协议

可以在此基础上实现更复杂的网络协议。

## 许可证

本项目采用MIT许可证。

## 贡献

欢迎提交Issue和Pull Request来改进项目。
