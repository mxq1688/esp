<!DOCTYPE html>
<html>
<head>
    <title>ESP32-S3 è°ƒè¯•å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 10px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; border-left: 4px solid #007bff; background: #f8f9fa; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        input { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ESP32-S3 è¿æ¥è°ƒè¯•å·¥å…·</h1>
    
    <div>
        <label>ESP32-S3 IPåœ°å€:</label>
        <input type="text" id="espIP" value="192.168.5.48" placeholder="192.168.x.x">
    </div>
    
    <div>
        <button onclick="testConnection()">ğŸ”— æµ‹è¯•è¿æ¥</button>
        <button onclick="getStatus()">ğŸ“Š è·å–çŠ¶æ€</button>
        <button onclick="setRed()">ğŸ”´ è®¾ç½®çº¢è‰²</button>
        <button onclick="setGreen()">ğŸŸ¢ è®¾ç½®ç»¿è‰²</button>
        <button onclick="setBlue()">ğŸ”µ è®¾ç½®è“è‰²</button>
    </div>
    
    <div id="results"></div>

    <script>
        function log(message, isError = false) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = 'result' + (isError ? ' error' : '');
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            results.insertBefore(div, results.firstChild);
        }

        function getESPIP() {
            return document.getElementById('espIP').value.trim();
        }

        async function testConnection() {
            const ip = getESPIP();
            log(`æ­£åœ¨æµ‹è¯•è¿æ¥åˆ° ${ip}...`);
            
            try {
                const response = await fetch(`http://${ip}/api/status`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… è¿æ¥æˆåŠŸï¼å½“å‰é¢œè‰²: R=${data.color.red} G=${data.color.green} B=${data.color.blue} äº®åº¦=${data.color.brightness}%`);
                } else {
                    log(`âŒ è¿æ¥å¤±è´¥ï¼šHTTP ${response.status}`, true);
                }
            } catch (error) {
                log(`âŒ è¿æ¥é”™è¯¯ï¼š${error.message}`, true);
            }
        }

        async function getStatus() {
            const ip = getESPIP();
            log(`æ­£åœ¨è·å–çŠ¶æ€...`);
            
            try {
                const response = await fetch(`http://${ip}/api/status`);
                const data = await response.json();
                log(`ğŸ“Š çŠ¶æ€: R=${data.color.red} G=${data.color.green} B=${data.color.blue} äº®åº¦=${data.color.brightness}%`);
            } catch (error) {
                log(`âŒ è·å–çŠ¶æ€å¤±è´¥ï¼š${error.message}`, true);
            }
        }

        async function setColor(red, green, blue, brightness = 75) {
            const ip = getESPIP();
            log(`æ­£åœ¨è®¾ç½®é¢œè‰² R=${red} G=${green} B=${blue} äº®åº¦=${brightness}%...`);
            
            try {
                const response = await fetch(`http://${ip}/api/color`, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        red: red,
                        green: green, 
                        blue: blue,
                        brightness: brightness
                    })
                });
                
                if (response.ok) {
                    log(`âœ… é¢œè‰²è®¾ç½®æˆåŠŸï¼`);
                    // éªŒè¯è®¾ç½®
                    setTimeout(getStatus, 500);
                } else {
                    log(`âŒ è®¾ç½®å¤±è´¥ï¼šHTTP ${response.status}`, true);
                }
            } catch (error) {
                log(`âŒ è®¾ç½®é”™è¯¯ï¼š${error.message}`, true);
            }
        }

        function setRed() { setColor(255, 0, 0); }
        function setGreen() { setColor(0, 255, 0); }
        function setBlue() { setColor(0, 0, 255); }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•è¿æ¥
        window.onload = function() {
            log('ğŸš€ è°ƒè¯•å·¥å…·å·²åŠ è½½');
            testConnection();
        };
    </script>
</body>
</html> 